<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Form Dokumentasi PMT Puskesmas Pagak 2025</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    input, select, button {
      display: block;
      width: 100%;
      margin-bottom: 15px;
      padding: 10px;
      font-size: 1em;
    }
    #status {
      margin-top: 15px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>DOKUMENTASI PMT PANGAN LOKAL<br>DAK NON FISIK PUSKESMAS PAGAK 2025</h2>

  <form id="uploadForm">
    <label>Tanggal:</label>
    <input type="date" name="tanggal" required>

    <label>Nama Desa:</label>
    <select name="desa" required>
      <option value="">-- Pilih Desa --</option>
      <option value="Gampingan">Gampingan</option>
      <option value="Tlogorejo">Tlogorejo</option>
      <option value="Sumberejo">Sumberejo</option>
      <option value="Pagak">Pagak</option>
    </select>

    <label>Nama Balita (opsional):</label>
    <input type="text" name="nama_balita">

    <label>Nama Ibu Hamil (opsional):</label>
    <input type="text" name="nama_ibu">

    <label>Upload Foto Balita (opsional):</label>
    <input type="file" name="foto_balita" accept="image/*">

    <label>Upload Foto Ibu Hamil (opsional):</label>
    <input type="file" name="foto_ibu" accept="image/*">

    <button type="submit">Kirim Data</button>
    <div id="status"></div>
  </form>

  <script>
    const form = document.getElementById('uploadForm');
    const status = document.getElementById('status');
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzh1D7UT84OXHw7TDeLu-At0Ikslj0hysJ-8NxerAwDCE7jibjXVJkRmacZ3yCqLpLefw/exec";

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      status.textContent = "Mengirim data...";

      const formData = new FormData(form);
      const getBase64 = (file) => {
        return new Promise((resolve) => {
          if (!file) return resolve("");
          const reader = new FileReader();
          reader.onloadend = () => resolve(reader.result.split(",")[1]);
          reader.readAsDataURL(file);
        });
      };

      const fotoBalita = await getBase64(formData.get("foto_balita"));
      const fotoIbu = await getBase64(formData.get("foto_ibu"));

      const data = {
        tanggal: formData.get("tanggal"),
        desa: formData.get("desa"),
        nama_balita: formData.get("nama_balita"),
        nama_ibu: formData.get("nama_ibu"),
        foto_balita: fotoBalita,
        foto_ibu: fotoIbu
      };

      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          redirect: "follow",
          headers: {
            "Content-Type": "text/plain;charset=utf-8"
          },
          body: JSON.stringify(data)
        });

        const result = await res.json();
        if (result.status === "success") {
          status.textContent = "✅ Data berhasil dikirim!";
          form.reset();
        } else {
          status.textContent = "❌ Gagal mengirim data. Coba lagi.";
        }
      } catch (err) {
        console.error(err);
        status.textContent = "❌ Gagal mengirim data. Pastikan koneksi internet stabil.";
      }
    });
  </script>
</body>
</html>
